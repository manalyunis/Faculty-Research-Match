services:
  # Faculty Research Match Web Service
  # Note: Links to existing database 'faculty-research-db'
  - type: web
    name: faculty-research-match
    runtime: docker
    plan: free
    region: oregon # Should match database region for best performance
    branch: main # Deploy from main branch

    # Link to database (Render automatically sets DATABASE_URL)
    envVars:
      - key: NODE_ENV
        value: production

      - key: PORT
        value: 3000

      - key: NEXT_TELEMETRY_DISABLED
        value: 1

      # Database connection (automatically set by Render when services are linked)
      - key: DATABASE_URL
        fromDatabase:
          name: faculty-research-db
          property: connectionString

      # Optional: OpenAI API Key (set manually in Render dashboard)
      - key: OPENAI_API_KEY
        sync: false # Set manually in Render dashboard (if needed)

      # Transformers.js cache location
      - key: TRANSFORMERS_CACHE
        value: /app/.cache

      # Application URL (update after deployment)
      - key: NEXT_PUBLIC_APP_URL
        value: https://faculty-research-match.onrender.com # Update with your actual URL

      # Feature flags
      - key: ENABLE_ADVANCED_SIMILARITY
        value: true

      - key: ENABLE_CACHING
        value: true

    # Build settings
    dockerfilePath: ./Dockerfile

    # Health check
    healthCheckPath: /api/health

    # Auto-deploy on push
    autoDeploy: true

    # Persistent disk for model cache
    disk:
      name: transformers-models
      mountPath: /app/.cache
      sizeGB: 1 # 1GB should be enough for the model (~25MB + overhead)

# Blueprint version
version: "1"
